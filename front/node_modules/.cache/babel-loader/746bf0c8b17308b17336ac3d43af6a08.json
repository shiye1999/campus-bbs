{"ast":null,"code":"import _asyncToGenerator from \"E:/gitTest/campus-bbs/front/node_modules/_@babel_runtime@7.17.9@@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"regenerator-runtime/runtime.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  data: function data() {\n    return {\n      userImg: require(\"../../src/assets/default.jpg\"),\n      user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\n      userInfo: {},\n      subscriberNumber: 0,\n      publisherNumber: 0,\n      commentNumber: 0,\n      usernameForm: {\n        username: \"\"\n      },\n      passwordForm: {\n        password: \"\",\n        rePassword: \"\"\n      },\n      loading: false\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    this.request.get(\"/user/\" + this.user.id).then(function (res) {\n      console.log(res);\n      _this.userInfo = res.data;\n    });\n    this.request.get(\"/user/relation/subscriberNumber\").then(function (res) {\n      console.log(res);\n      _this.publisherNumber = res.data;\n    });\n    this.request.get(\"/user/relation/publisherNumber\").then(function (res) {\n      console.log(res);\n      _this.subscriberNumber = res.data;\n    });\n    this.request.get(\"/comment/commentNumber/\" + this.user.id).then(function (res) {\n      console.log(res);\n      _this.commentNumber = res.data;\n    });\n\n    if (this.userInfo.avatarId !== 0) {\n      this.request.get(\"/file/\" + this.userInfo.avatarId).then(function (res) {\n        console.log(res);\n        _this.userImg = res.data;\n      });\n    }\n  },\n  methods: {\n    getUser: function getUser() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return _this2.request.get(\"/user/username/\" + _this2.user.username);\n\n              case 2:\n                return _context.abrupt(\"return\", _context.sent.data);\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }))();\n    },\n    changePWD: function changePWD() {\n      var _this3 = this;\n\n      this.request.post(\"/user/updatePWD\", this.passwordForm).then(function (res) {\n        console.log(res);\n\n        if (res.code === \"200\") {\n          _this3.$message.success(\"修改成功，请重新登录\");\n        } else {\n          _this3.$message.error(res.msg);\n        }\n\n        if (res.code === \"200\") {\n          location.reload();\n        }\n      });\n    },\n    changeName: function changeName() {\n      var _this4 = this;\n\n      this.request.post(\"/user/updateName\", this.usernameForm).then(function (res) {\n        console.log(res);\n\n        if (res.code === \"200\") {\n          _this4.$message.success(\"修改成功\");\n        } else {\n          _this4.$message.error(res.msg);\n        }\n\n        location.reload();\n      });\n    },\n    handleAvatarSuccess: function handleAvatarSuccess(res) {\n      this.userImg = res;\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqFA;AACAA,MADA,kBACA;AACA;AACAC,sDADA;AAEAC,wFAFA;AAGAC,kBAHA;AAIAC,yBAJA;AAKAC,wBALA;AAMAC,sBANA;AAOAC;AACAC;AADA,OAPA;AAUAC;AACAC,oBADA;AAEAC;AAFA,OAVA;AAcAC;AAdA;AAgBA,GAlBA;AAmBAC,SAnBA,qBAmBA;AAAA;;AACA,mDACA;AACAC;AACA;AACA,KAJA;AAMA,6DACA;AACAA;AACA;AACA,KAJA;AAMA,4DACA;AACAA;AACA;AACA,KAJA;AAMA,oEACA;AACAA;AACA;AACA,KAJA;;AAMA;AACA,+DACA;AACAA;AACA;AACA,OAJA;AAMA;AACA,GApDA;AAqDAC;AACAC,WADA,qBACA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACA,4DADA;;AAAA;AAAA,+DACAhB,IADA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,KAHA;AAIAiB,aAJA,uBAIA;AAAA;;AACA;AACAH;;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;;AACA;AACAI;AACA;AACA,OAVA;AAWA,KAhBA;AAiBAC,cAjBA,wBAiBA;AAAA;;AACA;AACAL;;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;;AACAI;AACA,OARA;AASA,KA3BA;AA4BAE,uBA5BA,+BA4BAC,GA5BA,EA4BA;AACA;AACA;AA9BA;AArDA","names":["data","userImg","user","userInfo","subscriberNumber","publisherNumber","commentNumber","usernameForm","username","passwordForm","password","rePassword","loading","created","console","methods","getUser","changePWD","location","changeName","handleAvatarSuccess","res"],"sourceRoot":"views/User","sources":["basicInfo.vue"],"sourcesContent":["<template>\r\n    <el-row class=\"userInfo\" :gutter=\"20\">\r\n        <el-col :span=\"6\" style=\"height:600px\">\r\n            <el-card>\r\n                <el-row>\r\n                    <div align=\"center\">\r\n                        <img class=\"user\" :src=\"userImg\">\r\n                    </div>\r\n                    <el-descriptions class=\"userInfo\" title=\"\" :column=\"1\" border>\r\n                        <el-descriptions-item label=\"用户名\">{{userInfo.username}}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"学号\">{{userInfo.schoolNumber}}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"角色\" v-if=\"userInfo.authority == 1\">管理员</el-descriptions-item>\r\n                        <el-descriptions-item label=\"角色\" v-if=\"userInfo.authority == 2\">认证用户</el-descriptions-item>\r\n                        <el-descriptions-item label=\"角色\" v-if=\"userInfo.authority == 3\">普通用户</el-descriptions-item>\r\n                        <el-descriptions-item label=\"关注数\">{{subscriberNumber}}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"粉丝数\">{{publisherNumber}}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"总发帖数\">{{commentNumber}}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"创建时间\">{{userInfo.createTime}}</el-descriptions-item>\r\n                    </el-descriptions>\r\n                </el-row>\r\n            </el-card>\r\n        </el-col>\r\n        <el-col :span=\"18\" class=\"box\">\r\n            <el-card style=\"height:200px\">\r\n                <div slot=\"header\" class=\"clearfix\" style=\"margin-top:20px\">\r\n                    <span>修改头像</span>\r\n                </div>\r\n                <div class=\"changeAvatar\">\r\n                    <el-upload\r\n                        class=\"avatar-uploader\"\r\n                        action=\"http://localhost:8081/file/upload\"\r\n                        :show-file-list=\"true\"\r\n                        :on-success=\"handleAvatarSuccess\"\r\n                    >\r\n                        <img v-if=\"userImg\" :src=\"userImg\" class=\"avatar\">\r\n                        <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n                    </el-upload>\r\n                </div>\r\n            </el-card>\r\n            <el-card style=\"height:300px padding:20px\">\r\n                <div slot=\"header\" class=\"clearfix\" style=\"margin-top:20px\">\r\n                    <span>修改用户名</span>\r\n                </div>\r\n                <el-form autocomplete=\"on\" :model=\"usernameForm\" ref=\"usernameForm\" label-position=\"left\">\r\n                    <el-form-item prop=\"username\">\r\n                        <el-input name=\"username\" type=\"text\" v-model=\"usernameForm.username\" autocomplete=\"on\"\r\n                            placeholder=\"请输入新的用户名\">\r\n                            <span slot=\"prefix\"></span>\r\n                        </el-input>\r\n                    </el-form-item>\r\n                    <el-form-item style=\"margin-bottom: 20px\">\r\n                        <el-button style=\"width: 10%\" type=\"primary\" :loading=\"loading\"\r\n                            @click.native.prevent=\"changeName\">提交\r\n                        </el-button>\r\n                    </el-form-item>\r\n                </el-form>\r\n            </el-card>\r\n            <el-card style=\"height:300px margin-top:20px\">\r\n                <div slot=\"header\" class=\"clearfix\">\r\n                    <span>修改密码</span>\r\n                </div>\r\n                <el-form autocomplete=\"on\" :model=\"passwordForm\" ref=\"passwordForm\" label-position=\"left\">\r\n                    <el-form-item prop=\"password\">\r\n                        <el-input name=\"password\" type=\"text\" v-model=\"passwordForm.password\" autocomplete=\"on\"\r\n                            placeholder=\"请输入旧的密码\">\r\n                            <span slot=\"prefix\"></span>\r\n                        </el-input>\r\n                    </el-form-item>\r\n                    <el-form-item prop=\"rePassword\">\r\n                        <el-input name=\"rePassword\" type=\"text\" v-model=\"passwordForm.rePassword\" autocomplete=\"on\"\r\n                            placeholder=\"请输入新的密码\">\r\n                            <span slot=\"prefix\"></span><span slot=\"suffix\"></span>\r\n                        </el-input>\r\n                    </el-form-item>\r\n                    <el-form-item style=\"margin-bottom: 20px\">\r\n                        <el-button style=\"width: 10%\" type=\"primary\" :loading=\"loading\"\r\n                            @click.native.prevent=\"changePWD\">提交</el-button>\r\n                    </el-form-item>\r\n                </el-form>\r\n            </el-card>\r\n        </el-col>\r\n    </el-row>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n        data() {\r\n            return {\r\n                userImg: require(\"../../src/assets/default.jpg\"),\r\n                user: localStorage.getItem(\"user\") ? JSON.parse(localStorage.getItem(\"user\")) : {},\r\n                userInfo: {},\r\n                subscriberNumber: 0,\r\n                publisherNumber: 0,\r\n                commentNumber: 0,\r\n                usernameForm: {\r\n                    username: \"\",\r\n                },\r\n                passwordForm: {\r\n                    password: \"\",\r\n                    rePassword: \"\"\r\n                },\r\n                loading: false,\r\n            }\r\n        },\r\n        created() {\r\n            this.request.get(\"/user/\" + this.user.id).then(\r\n                res => {\r\n                    console.log(res)\r\n                    this.userInfo = res.data\r\n                }\r\n            )\r\n            this.request.get(\"/user/relation/subscriberNumber\").then(\r\n                res => {\r\n                    console.log(res)\r\n                    this.publisherNumber = res.data\r\n                }\r\n            )\r\n            this.request.get(\"/user/relation/publisherNumber\").then(\r\n                res => {\r\n                    console.log(res)\r\n                    this.subscriberNumber = res.data\r\n                }\r\n            )\r\n            this.request.get(\"/comment/commentNumber/\" + this.user.id).then(\r\n                res => {\r\n                    console.log(res)\r\n                    this.commentNumber = res.data\r\n                }\r\n            )\r\n            if(this.userInfo.avatarId!==0){\r\n                this.request.get(\"/file/\" + this.userInfo.avatarId).then(\r\n                    res => {\r\n                        console.log(res)\r\n                        this.userImg = res.data\r\n                    }\r\n                )\r\n            }\r\n        },\r\n        methods: {\r\n            async getUser() {\r\n                return (await this.request.get(\"/user/username/\" + this.user.username)).data\r\n            },\r\n            changePWD() {\r\n                this.request.post(\"/user/updatePWD\", this.passwordForm).then(res => {\r\n                    console.log(res)\r\n                    if (res.code === \"200\") {\r\n                        this.$message.success(\"修改成功，请重新登录\")\r\n                    } else {\r\n                        this.$message.error(res.msg)\r\n                    }\r\n                    if (res.code === \"200\") {\r\n                        location.reload()\r\n                    }\r\n                })\r\n            },\r\n            changeName() {\r\n                this.request.post(\"/user/updateName\", this.usernameForm).then(res => {\r\n                    console.log(res)\r\n                    if (res.code === \"200\") {\r\n                        this.$message.success(\"修改成功\")\r\n                    } else {\r\n                        this.$message.error(res.msg)\r\n                    }\r\n                    location.reload()\r\n                })\r\n            },\r\n            handleAvatarSuccess(res) {\r\n                this.userImg = res\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n    .el-card {\r\n\r\n        .user {\r\n            margin-top: 10px;\r\n            width: 80px;\r\n            height: 80px;\r\n            border-radius: 50%;\r\n        }\r\n\r\n        .userInfo {\r\n            margin-top: 20px;\r\n        }\r\n\r\n        margin-bottom:20px; //下边距\r\n    }\r\n\r\n    .el-col {\r\n        margin-top: 20px;\r\n    }\r\n\r\n    .el-input {\r\n        margin-top: 10px;\r\n    }\r\n\r\n    .el-button {\r\n        margin-top: 10px;\r\n    }\r\n\r\n    .box {\r\n        height: 80%;\r\n        display: flex;\r\n        flex-direction: column; //起作用的是这个，没有的话会变成下图的样子，卡片跑到右边去了\r\n    }\r\n\r\n\r\n    .changeAvatar {\r\n        margin-top: 10px;\r\n    }\r\n\r\n    .changeName {\r\n        margin-top: 10px;\r\n    }\r\n\r\n    .changePwd {\r\n        margin-top: 10px;\r\n    }\r\n\r\n    .avatar-uploader .el-upload {\r\n        border: 1px dashed #d9d9d9;\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n        position: relative;\r\n        overflow: hidden;\r\n    }\r\n\r\n    .avatar-uploader .el-upload:hover {\r\n        border-color: #409EFF;\r\n    }\r\n\r\n    .avatar-uploader-icon {\r\n        font-size: 28px;\r\n        color: #8c939d;\r\n        width: 98px;\r\n        height: 98px;\r\n        line-height: 98px;\r\n        text-align: center;\r\n    }\r\n\r\n    .avatar {\r\n        width: 98px;\r\n        height: 98px;\r\n        display: block;\r\n    }\r\n</style>"]},"metadata":{},"sourceType":"module"}